<template>
    <lightning-card title="Create Case with ESE Request Lines" icon-name="standard:case">
        <div class="slds-form-element">
            <lightning-record-edit-form object-api-name="Case" onsuccess={handleSuccess} onerror={handleError}>
                <lightning-layout>
                  
                        <lightning-layout-item size="12" small-device-size="6" medium-device-size="4" large-device-size="2" padding="around-small">
                            <lightning-input-field field-name="AccountId" onchange={handleInputChange} class="slds-hide"></lightning-input-field>
                        </lightning-layout-item>
                        <lightning-input-field field-name="Status" value="In Progress" class="slds-hide"></lightning-input-field>
                        <lightning-input-field field-name="Status_Category__c" value="Pending with ET" class="slds-hide"></lightning-input-field>
                        <lightning-input-field field-name="Subject" value="Global Event" class="slds-hide"></lightning-input-field>
                     
                    <lightning-layout-item size="12" small-device-size="6" medium-device-size="4" large-device-size="2" padding="around-small">
                        <label for="fieldid">ESE User Name</label>
                        <lightning-input-field  id="fieldid" variant="label-hidden" field-name="ContactId" lable="hidden" onchange={handleInputChange}></lightning-input-field>
                    </lightning-layout-item>
                    <lightning-layout-item size="12" small-device-size="6" medium-device-size="4" large-device-size="2" padding="around-small">
                        <lightning-input-field field-name="Type_Of_Case__c" onchange={handleInputChange}></lightning-input-field>
                    </lightning-layout-item>
                </lightning-layout>
                <table class="slds-table slds-table_bordered slds-no-row-hover slds-table_cell-buffer" role="grid">
                    <thead>
                        <tr class="slds-line-height_reset">
                            <th>Line number</th>
                            <th></th>
                            <th></th>
                            <th>Request Line Deatils</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                <template for:each={eseRequestLines} for:item="line" for:index="index">
                    <tr key={line.id}>
                        <td>
                          {line.number}
                        </td>

                        <td>
                          <label>School Name</label>
                           <c-custom-lookup-Global
                           name="accountLookup"
                           field-label="Account"
                           child-object-api-name="Contact"
                           target-field-api-name="AccountId"
                           required="true"
                           add-to-recent="true"
                           onvalueselected={handleSelectedLookup}
                           data-id={index} 
                           ></c-custom-lookup-Global>
                            <lightning-input value={line.Trip_Date__c}  label="Trip Date" data-id={index} data-field="Trip_Date__c" type="date" onchange={handleEseInputChange}></lightning-input>
                            <lightning-input  value={line.Trip_Destination_From__c}  label="Trip Destination from" data-id={index} data-field="Trip_Destination_From__c" onchange={handleEseInputChange}></lightning-input>
                        </td>
                        <td>
                            <lightning-input value={line.Trip_Coordinator_Name__c}  label="Trip Coordinator Name" data-id={index} data-field="Trip_Coordinator_Name__c" onchange={handleEseInputChange}></lightning-input>
                            <lightning-input value={line.Coordinator_Phone__c} label="Coordinator_Phone" data-id={index} data-field="Coordinator_Phone__c" type="tel" onchange={handleEseInputChange}></lightning-input>
                            <lightning-input value={line.Trip_Destination_To__c}   label="Trip Destination To" data-id={index} data-field="Trip_Destination_To__c" onchange={handleEseInputChange}></lightning-input>
                        </td>
                        <td>
                            <lightning-input value={line.Email__c} data-id={index} label="Email" data-field="Email__c" type="email" onchange={handleEseInputChange}></lightning-input>
                            <lightning-input value={line.Cycle__c} data-id={index} label="Cycle" data-field="Cycle__c"  type="number" onchange={handleEseInputChange}></lightning-input>
                            <lightning-input value={line.Count_Of_Students__c} label="Count_Of_Students" data-id={index} data-field="Count_Of_Students__c" type="number" onchange={handleEseInputChange}></lightning-input>
                        </td>
                        <td>
                            <lightning-input value={line.Special_Need_Students_Count__c} label="Special_Need_Students_Count" data-id={index} data-field="Special_Need_Students_Count__c" type="number" onchange={handleEseInputChange}></lightning-input>
                            <lightning-input value={line.Supervisors_Count_From_School__c}  label="Supervisors_Count_From_School" data-id={index} data-field="Supervisors_Count_From_School__c" type="number" onchange={handleEseInputChange}></lightning-input>
                            <lightning-input value={line.Arrival_Time_To_Activity__c}  label="Arrival_Time_To_Activity" data-id={index} data-field="Arrival_Time_To_Activity__c" type="time" onchange={handleEseInputChange}></lightning-input>

                        </td>
                        <td>
                            <lightning-input value={line.Assembly_Point__c} label="Assembly_Point" data-id={index} data-field="Assembly_Point__c" onchange={handleEseInputChange}></lightning-input>
                            <lightning-input value={line.Landmark_Trip_To__c} label="Landmark Trip To" data-id={index} data-field="Landmark_Trip_To__c" onchange={handleEseInputChange}></lightning-input>
                            <lightning-input value={line.Landmark_Trip_From__c} label="Landmark_Trip_From" data-id={index} data-field="Landmark_Trip_From__c" onchange={handleEseInputChange}></lightning-input>
                           
                        </td>
                        <td>
                            <lightning-combobox value={line.Gender__c}  data-id={index} label="Gender" data-field="Gender__c"   options={genderOptions} placeholder="Select Gender" onchange={handleEseInputChange}></lightning-combobox>
                            <lightning-input value={line.Leaving_time_from_Location__c}  label="Leaving_time_from_Location" data-id={index} data-field="Leaving_time_from_Location__c" type="time" onchange={handleEseInputChange}></lightning-input>
                          
                        </td>
                        <td>
                            <lightning-button-icon icon-name="utility:add" alternative-text="Add ESE Request Line" onclick={addESERequestLine}></lightning-button-icon>
                            <lightning-button-icon icon-name="utility:delete" alternative-text="Delete" onclick={deleteESERequestLine} data-id={index}></lightning-button-icon>

                        </td>           
                    </tr>
                     
                     
                </template>
                   </table>
                   <footer class="slds-modal__footer" style="padding: 0.50rem 1rem;">
                <lightning-button label="Save"  icon-name="utility:save" onclick={createCaseWithESERequestLines} class="slds-m-top_medium" variant="brand"></lightning-button>
                </footer>
            </lightning-record-edit-form>
        </div>
    </lightning-card>
</template>